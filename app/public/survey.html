<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Survey</title>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <!-- Chosen -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.2/chosen-sprite.png">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.2/chosen-sprite@2x.png">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.2/chosen.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.2/chosen.jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.2/chosen.proto.min.js"></script>
    <!-- Custom -->
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="container h-100">
        <div class="row h-100">
          <div class="col-lg-12 my-auto">
            <div class="mx-auto">
              <h2>Survey Questions</h2>
              <br>
              <h3>About You</h3>
              <p>
              <h4>Name (required)</h4>
              <input type="text" name="" id="name" class="form-control" required tabindex="1">
              </p>
              <p>
              <h4>Link to Photo Image (required)</h4>
              <input type="text" name="" id="photo" class="form-control" required tabindex="2">
              </p>
              <p>
              <h3>Question 1</h3>
              <h4>You prefer to be neat and organized.</h4>
              <select data-placeholder="" class="chosen-select" id="q1" tabindex="3">
                <option value=""></option>
                <option value="1">1 (Strongly disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly agree)</option>
              </select>
              </p>
              <p>
              <h3>Question 2</h3>
              <h4>You love pets.</h4>
              <select data-placeholder="Select an option..." class="chosen-select" id="q2" tabindex="4">
                <option value=""></option>
                <option value="1">1 (Strongly disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly agree)</option>
              </select>
              </p>
              <p>
              <h3>Question 3</h3>
              <h4>You are adventurous and seek exciting things to do.</h4>
              <select data-placeholder="Select an option..." class="chosen-select" id="q3" tabindex="5">
                <option value=""></option>
                <option value="1">1 (Strongly disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly agree)</option>
              </select>
              </p>
              <p>
              <h3>Question 4</h3>
              <h4>You insist that others follow your ideas.</h4>
              <select data-placeholder="Select an option..." class="chosen-select" id="q4" tabindex="6">
                <option value=""></option>
                <option value="1">1 (Strongly disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly agree)</option>
              </select>
              </p>
              <p>
              <h3>Question 5</h3>
              <h4>You strictly adhere to a vegan diet.</h4>
              <select data-placeholder="Select an option..." class="chosen-select" id="q5" tabindex="7">
                <option value=""></option>
                <option value="1">1 (Strongly disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly agree)</option>
              </select>
              </p>
              <p>
              <h3>Question 6</h3>
              <h4>You love to read books for hours and hours.</h4>
              <select data-placeholder="Select an option..." class="chosen-select" id="q6" tabindex="8">
                <option value=""></option>
                <option value="1">1 (Strongly disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly agree)</option>
              </select>
              </p>
              <p>
              <h3>Question 7</h3>
              <h4>You enjoy blasting rap music.</h4>
              <select data-placeholder="Select an option..." class="chosen-select" id="q7" tabindex="9">
                <option value=""></option>
                <option value="1">1 (Strongly disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly agree)</option>
                </select>
              </p>
              <p>
              <h3>Question 8</h3>
              <h4>You love to spend all of your money drinking at bars.</h4>
              <select data-placeholder="Select an option..." class="chosen-select" id="q8" tabindex="10">
                <option value=""></option>
                <option value="1">1 (Strongly disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly agree)</option>
              </select>
              </p>
              <p>
              <h3>Question 9</h3>
              <h4>You always follow the rules.</h4>
              <select data-placeholder="Select an option..." class="chosen-select" id="q9" tabindex="11">
                <option value=""></option>
                <option value="1">1 (Strongly disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly agree)</option>
              </select>
              </p>
              <p>
              <h3>Question 10</h3>
              <h4>You value cooperation over competition.</h4>
              <select data-placeholder="Select an option..." class="chosen-select" id="q10" tabindex="12">
                <option value=""></option>
                <option value="1">1 (Strongly disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly agree)</option>
              </select>
              </p>
              <!-- Submit Button -->
              <br><br>
              <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit">Submit</button>
              <br><br>
            </div>
          </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title" id="modalLabel">Best Match</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
              <h2 id="userName"></h2>
              <img class="img-fluid" id="userImage" src="avatar-1577909_960_720.png" alt="">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">

        // Chosen configuration
        // applied to all 'chosen-select' elements.
        var config = {
            allow_single_deselect: true,
            placeholder_text_single: "Select an option...",
            disable_search_threshold: 10,
            no_results_text: "Oops, nothing found!",
            width: "35%"
        }
        $(".chosen-select").chosen(config);
        
        // Here is where the survey submit button is
        // handled. AJAX POST is sent to the server.
        $("#submit").on("click", function(){

            if( validateSurvey() ){

                var userData = {
                    name: $("#name").val(),
                    photo: $("#photo").val(),
                    scores: [$("#q1").val(),
                             $("#q2").val(),
                             $("#q3").val(),
                             $("#q4").val(),
                             $("#q5").val(),
                             $("#q6").val(),
                             $("#q7").val(),
                             $("#q8").val(),
                             $("#q9").val(),
                             $("#q10").val()]
                };

                var currentURL = window.location.origin;
                $.post(currentURL + "/api/friends", userData, function(response){

                    // Response should contain the best matching friend.
                    if(response){
                        if(response.alert){
                            alert(response.alert);
                        } else{
                            $("#userName").text(response.name);
                            $("#userImage").attr("src", response.photo);

                            $("#myModal").modal("toggle");
                        }
                    }
                });
            } else{

                alert("Please fill out all survey fields.");
            }
        });

        // Ensure that all survey fields are populated.
        function validateSurvey(){

            var result = false;

            if($("#name").val() !== "" &&
               $("#photo").val() !== "" &&
               $("#q1").val() !== "" &&
               $("#q2").val() !== "" &&
               $("#q3").val() !== "" &&
               $("#q4").val() !== "" &&
               $("#q5").val() !== "" &&
               $("#q6").val() !== "" &&
               $("#q7").val() !== "" &&
               $("#q8").val() !== "" &&
               $("#q9").val() !== "" &&
               $("#q10").val() !== ""){

                result = true;
            }

            return result;
        }

    </script>
</body>

<footer class="footer mb-2">
  <div class="container">
    <a href="/api/friends">API Friends List</a>
  </div>
</footer>

</html>